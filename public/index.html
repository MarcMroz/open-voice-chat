<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sesli Sohbet | GÃ¼venli ve HÄ±zlÄ± Ä°letiÅŸim</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.1/dist/peerjs.min.js"></script>
    <script src="/vendor/i18next.min.js"></script>
    <script src="/vendor/i18nextHttpBackend.min.js"></script>
    <script src="/vendor/i18nextBrowserLanguageDetector.min.js"></script>
    <link rel="stylesheet" href="/styles.css">
</head>

<body>

    <div id="https-warning">
        âš ï¸ Mikrofon izni iÃ§in HTTPS gereklidir. Localhost veya Cloudflare Tunnel kullanÄ±n.
    </div>

    <!-- Toast -->
    <div id="notification-toast" onclick="window.location.reload()" role="button" tabindex="0">
        ğŸ¤ Mikrofon algÄ±landÄ±! KatÄ±lmak iÃ§in tÄ±klayÄ±n.
    </div>

    <!-- Vote Modal -->
    <div id="vote-modal">
        <h3 id="vote-text" style="margin:0; color:white;">Oy Ver: ...</h3>
        <p style="margin:5px 0; color:#aaa; font-size:12px;" id="vote-subtext">KullanÄ±cÄ±yÄ± atmak istiyor musunuz?</p>
        <div class="vote-actions" id="vote-buttons">
            <button id="vote-yes-btn" class="vote-btn-yes" onclick="submitVote(true)">Evet</button>
            <button id="vote-no-btn" class="vote-btn-no" onclick="submitVote(false)">HayÄ±r</button>
        </div>
        <div id="vote-status" style="display:none; margin-top:15px; font-weight:bold; color:#ccc;">
            Oyunuz alÄ±ndÄ±, sonuÃ§ bekleniyor...
        </div>
        <div id="vote-timer-bar-container" style="background:#444; height:4px; margin-top:10px; border-radius:2px;">
            <div id="vote-timer"></div>
        </div>
    </div>

    <div id="app-popup-backdrop" role="dialog" aria-modal="true" aria-labelledby="app-popup-message">
        <div id="app-popup">
            <p id="app-popup-message"></p>
            <input id="app-popup-input" type="text" autocomplete="nickname" aria-labelledby="app-popup-message">
            <div id="app-popup-actions">
                <button id="app-popup-cancel-btn" style="display:none;"></button>
                <button id="app-popup-ok-btn"></button>
            </div>
        </div>
    </div>

    <!-- Login -->
    <div id="login-overlay">
        <div class="login-box">
            <h2 id="login-title">ğŸ™ï¸ Sesli Sohbet</h2>
            <div class="login-avatar-area" onclick="showAvatarPicker()">
                <img id="login-avatar-preview" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'/%3E" class="login-avatar-img" alt="Avatar">
                <span class="login-avatar-edit">ğŸ¨</span>
            </div>
            <input type="text" id="nickname-input" placeholder="KullanÄ±cÄ± AdÄ±" value="Misafir" autocomplete="nickname">
            <select id="room-select" onchange="checkRoomLock()">
                <option value="" disabled selected>Odalar YÃ¼kleniyor...</option>
            </select>
            <input type="password" id="password-input" placeholder="Oda Åifresi" autocomplete="current-password" onkeydown="if (event.key === 'Enter') { event.preventDefault(); startApp(); }">
            <button id="join-btn" onclick="startApp()">Odaya KatÄ±l</button>
            <div class="settings-area" style="justify-content: center;">
                <label class="checkbox-wrapper">
                    <input type="checkbox" id="sound-toggle-login" checked> <span id="notification-sounds-label">ğŸ”Š Bildirim Sesleri</span>
                </label>
            </div>
            <div class="settings-area" style="justify-content: center;">
                <label class="checkbox-wrapper">
                    <input type="checkbox" id="noise-suppression-toggle" checked> <span id="noise-suppression-label">ğŸ”‡ Noise Suppression</span>
                </label>
            </div>
            <div class="settings-area" style="justify-content: center;">
                <label class="checkbox-wrapper">
                    ğŸŒ
                    <select id="language-select">
                        <option value="tr">TÃ¼rkÃ§e</option>
                        <option value="en">English</option>
                        <option value="es">EspaÃ±ol</option>
                    </select>
                </label>
            </div>
        </div>
    </div>

    <!-- Avatar Picker Modal -->
    <div id="avatar-picker-backdrop" role="dialog" aria-modal="true">
        <div id="avatar-picker">
            <h3 id="avatar-picker-title">Choose Your Avatar</h3>
            <img id="avatar-picker-preview" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'/%3E" class="avatar-picker-preview-img" alt="Avatar Preview">
            <div class="avatar-picker-section">
                <label class="avatar-picker-label" id="avatar-picker-style-label">Style</label>
                <div id="avatar-picker-sets" class="avatar-picker-options"></div>
            </div>
            <div class="avatar-picker-section">
                <label class="avatar-picker-label" id="avatar-picker-bg-label">Background</label>
                <div id="avatar-picker-bgs" class="avatar-picker-options"></div>
            </div>
            <div id="avatar-picker-actions">
                <button id="avatar-picker-cancel">Cancel</button>
                <button id="avatar-picker-confirm">OK</button>
            </div>
        </div>
    </div>

    <!-- Main UI -->
    <div id="app-container">

        <!-- Video/User Section -->
        <div id="main-content">
            <header>
                <div style="display:flex; align-items:center; gap:15px;">
                    <h3 id="room-display" style="margin:0">Oda: ...</h3>
                    <label class="checkbox-wrapper" id="sound-toggle-main-label" title="GiriÅŸ/Ã‡Ä±kÄ±ÅŸ Sesleri" style="margin:0; padding:4px 8px;">
                        <input type="checkbox" id="sound-toggle-main" checked onchange="syncSoundToggle(this)"> ğŸ””
                    </label>
                </div>
                
                <!-- Control Buttons -->
                <div id="header-controls" style="display:flex; gap:10px; align-items:center;">
                    <button onclick="toggleScreenShare()" id="btn-share-screen-header" title="Ekran PaylaÅŸ" style="width:auto; margin:0; padding:8px 16px; display:none;">
                        ğŸ–¥ï¸ Ekran PaylaÅŸ
                    </button>
                    <button onclick="toggleMyMute()" id="my-mute-btn" style="min-width:132px; margin:0; padding:8px 16px; white-space:nowrap;">
                        ğŸ¤ Sustur
                    </button>
                    <button id="leave-btn" onclick="window.location.reload()" style="background:linear-gradient(135deg, var(--danger-color), #dc2626); width:auto; margin:0; padding:8px 16px;">
                        ğŸšª AyrÄ±l
                    </button>
                </div>
            </header>

            <!-- Stage for Cinema Mode -->
            <div id="screen-stage">
                <div id="screen-stage-header">
                    <div id="screen-stage-label">ğŸ–¥ï¸ Ekran PaylaÅŸÄ±mÄ±</div>
                    <button id="fullscreen-btn" onclick="toggleFullscreen()">â›¶ Tam Ekran</button>
                </div>
                <video id="stage-video" autoplay playsinline ondblclick="toggleFullscreen()"></video>
            </div>

            <div id="user-grid">
            </div>
        </div>

        <!-- Chat Section -->
        <div id="chat-panel">
            <!-- Tab Navigation -->
            <div class="chat-tabs" role="tablist">
                <button class="chat-tab active" id="chat-tab-btn" onclick="switchTab('chat', this)" role="tab" aria-controls="chat-tab-content" aria-selected="true">ğŸ’¬ Sohbet</button>
                <button class="chat-tab" id="participants-tab-btn" onclick="switchTab('participants', this)" role="tab" aria-controls="participants-tab-content" aria-selected="false"><span id="participants-tab-label">ğŸ‘¥ KatÄ±lÄ±mcÄ±lar</span><span class="participant-count-badge" id="participant-count">0</span></button>
                <button class="chat-tab" id="reactions-tab-btn" onclick="switchTab('reactions', this)" role="tab" aria-controls="reactions-tab-content" aria-selected="false">ğŸ˜‚ Tepkiler</button>
            </div>

            <!-- Chat Tab Content -->
            <div id="chat-tab-content" class="tab-content active" role="tabpanel">
                <div id="chat-messages"></div>
                <div id="chat-input-area">
                    <input type="text" id="message-input" placeholder="Bir mesaj yaz..." onkeypress="handleEnter(event)">
                    <button id="send-btn" onclick="sendMessage()" style="width: auto; margin:0;">GÃ¶nder</button>
                </div>
            </div>

            <!-- Participants Tab Content -->
            <div id="participants-tab-content" class="tab-content" role="tabpanel" hidden>
                <div id="participants-list">
                    <!-- Participants will be added dynamically -->
                </div>
            </div>

            <!-- Reactions Tab Content -->
            <div id="reactions-tab-content" class="tab-content" role="tabpanel" hidden>
                <div id="reactions-list">
                    <!-- Reactions will be loaded dynamically -->
                </div>
            </div>
        </div>
    </div>

    <script src="/app.js"></script>
</body>

</html>
